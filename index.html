<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Nohttp by yanzhenjie</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Nohttp</h1>
      <h2 class="project-tagline">Android Http标准框架，底层OkHttp，与RxJava完美结合，比Retrofit更简单易用。</h2>
      <a href="https://github.com/yanzhenjie/NoHttp" class="btn">View on GitHub</a>
      <a href="https://github.com/yanzhenjie/NoHttp/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/yanzhenjie/NoHttp/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="nohttp一个有情怀的网络框架" class="anchor" href="#nohttp%E4%B8%80%E4%B8%AA%E6%9C%89%E6%83%85%E6%80%80%E7%9A%84%E7%BD%91%E7%BB%9C%E6%A1%86%E6%9E%B6" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>NoHttp，一个有情怀的网络框架</h1>

<p><img src="http://www.nohttp.net/image/nohttp_logo.svg" alt="NoHttp Logo">  </p>

<p>严振杰的博客：<a href="http://blog.yanzhenjie.com">blog.yanzhenjie.com</a>   </p>

<p>NoHttp重要升级，支持与<code>RxJava</code>完美结合、支持一句话切换底层为<code>OkHttp</code>，支持请求Restful风格的接口，比Retrofit更简单易用。  </p>

<p><strong>欢迎加入QQ交流群：<a href="http://jq.qq.com/?_wv=1027&amp;k=40Qqms0">547839514</a></strong></p>

<hr>

<h2>
<a id="导航目录点击可跳转到对应节点处" class="anchor" href="#%E5%AF%BC%E8%88%AA%E7%9B%AE%E5%BD%95%E7%82%B9%E5%87%BB%E5%8F%AF%E8%B7%B3%E8%BD%AC%E5%88%B0%E5%AF%B9%E5%BA%94%E8%8A%82%E7%82%B9%E5%A4%84" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>导航目录(点击可跳转到对应节点处)</h2>

<ul>
<li>
<a href="#%E6%95%88%E6%9E%9C%E9%A2%84%E8%A7%88">Demo效果预览</a><br>
</li>
<li>
<a href="#%E6%A1%86%E6%9E%B6%E7%89%B9%E6%80%A7">NoHttp特性</a><br>
</li>
<li>
<a href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95">AndroidStuio、Eclipse使用方法</a><br>
</li>
<li>
<a href="#%E5%88%9D%E5%A7%8B%E5%8C%96">NoHttp初始化</a><br>
</li>
<li>
<a href="#%E6%9D%83%E9%99%90">需要的权限</a><br>
</li>
<li>
<a href="#%E5%8F%8B%E5%A5%BD%E7%9A%84%E8%B0%83%E8%AF%95%E6%A8%A1%E5%BC%8F">友好的调试模式</a><br>
</li>
<li>
<a href="#%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BC%82%E6%AD%A5%E6%A1%86%E6%9E%B6">RxJava</a><br>
</li>
<li>
<a href="#%E8%AF%B7%E6%B1%82%E9%98%9F%E5%88%97">请求队列</a><br>
</li>
<li>
<a href="#%E5%87%A0%E7%A7%8D%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E8%AF%B7%E6%B1%82">String、Bitmap、JavaBean、Json请求</a><br>
</li>
<li>
<a href="#%E6%B7%BB%E5%8A%A0%E5%8F%82%E6%95%B0">添加参数，可以链式调用</a><br>
</li>
<li>
<a href="#%E6%8F%90%E4%BA%A4%E8%AF%B7%E6%B1%82%E5%8C%85%E4%BD%93">提交Json、XML、自定义Body等</a><br>
</li>
<li>
<a href="#%E5%90%8C%E6%AD%A5%E8%AF%B7%E6%B1%82">同步请求</a><br>
</li>
<li>
<a href="#%E4%BA%94%E5%A4%A7%E7%BC%93%E5%AD%98%E6%A8%A1%E5%BC%8F">五大缓存模式</a><br>
</li>
<li>
<a href="#%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD">文件下载</a><br>
</li>
<li>
<a href="#%E5%8F%96%E6%B6%88%E8%AF%B7%E6%B1%82">如何取消请求</a><br>
</li>
<li>
<a href="#%E5%81%9C%E6%AD%A2%E9%98%9F%E5%88%97">停止队列</a><br>
</li>
<li>
<a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AF%B7%E6%B1%82">自定义请求</a><br>
</li>
<li>
<a href="#%E4%BB%A3%E7%A0%81%E6%B7%B7%E6%B7%86">代码混淆</a><br>
</li>
</ul>

<h2>
<a id="效果预览" class="anchor" href="#%E6%95%88%E6%9E%9C%E9%A2%84%E8%A7%88" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>效果预览</h2>

<p>    </p>

<p>  </p>

<h2>
<a id="框架特性" class="anchor" href="#%E6%A1%86%E6%9E%B6%E7%89%B9%E6%80%A7" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>框架特性</h2>

<p>比Retrofit使用更简单、更易用。</p>

<ul>
<li>动态配置底层框架为<strong>OkHttp</strong>、HttpURLConnection</li>
<li>与<strong>RxJava</strong>完美结合，支持异步请求、支持同步请求</li>
<li>多文件上传，支持大文件上传，表单提交数据</li>
<li>文件下载、上传下载、上传和下载的进度回调、错误回调</li>
<li>支持Json、xml、Map、List的提交</li>
<li>完美的Http缓存模式，可指定缓存到数据库、SD卡，缓存数据已安全加密

<ul>
<li>在6.0以上手机缓存到SD卡时需要请求运行时权限：<a href="https://github.com/yanzhenjie/AndPermission">AndPermission</a>
</li>
</ul>
</li>
<li>自定义Request，直接请求JsonObject、JavaBean等</li>
<li>Cookie的自动维持，App重启、关开机后还持续维持</li>
<li>http 301 302 303 304 307重定向，支持多层嵌套重定向</li>
<li>Https、自签名网站Https的访问、支持双向验证</li>
<li>失败重试机制，支持请求优先级</li>
<li>GET、POST、PUT、PATCH、HEAD、DELETE、OPTIONS、TRACE等请求协议</li>
<li>用队列保存请求，平均分配多线程的资源，支持多个请求并发</li>
<li>支持取消某个请求、取消指定多个请求、取消所有请求</li>
</ul>

<h2>
<a id="使用方法" class="anchor" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>使用方法</h2>

<h3>
<a id="androidstudio使用方式" class="anchor" href="#androidstudio%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>AndroidStudio使用方式</h3>

<ul>
<li>如果使用HttpURLConnection作为网络层：<br>
</li>
</ul>

<div class="highlight highlight-source-groovy"><pre>compile <span class="pl-s"><span class="pl-pds">'</span>com.yolanda.nohttp:nohttp:1.1.0<span class="pl-pds">'</span></span></pre></div>

<ul>
<li>如果要使用OkHttp作为网络层，请再依赖：<br>
</li>
</ul>

<div class="highlight highlight-source-groovy"><pre>compile <span class="pl-s"><span class="pl-pds">'</span>com.yanzhenjie.nohttp:okhttp:1.1.0<span class="pl-pds">'</span></span></pre></div>

<h3>
<a id="eclipse使用方式" class="anchor" href="#eclipse%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Eclipse使用方式</h3>

<ul>
<li>如果使用HttpURLConnection作为网络层：<br>
<a href="https://github.com/yanzhenjie/NoHttp/blob/master/Jar/nohttp1.1.0.jar?raw=true">下载NoHttp Jar包</a><br>
</li>
<li><p>如果使用OkHttp做为网络层<br>
<a href="https://github.com/yanzhenjie/NoHttp/blob/master/Jar/nohttp-okhttp1.1.0.jar?raw=true">下载NoHttp-OkHttp Jar包</a>，并且请自行下载<a href="https://github.com/square/okhttp">okhttp</a>、<a href="https://github.com/square/okio">okio</a>的jar包。</p></li>
<li><p>建议没用Android的同学尽早切换到AndroidStudio来开发Android应用。</p></li>
</ul>

<h2>
<a id="初始化" class="anchor" href="#%E5%88%9D%E5%A7%8B%E5%8C%96" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>初始化</h2>

<p>NoHttp初始化需要一个Context，最好在<code>Application</code>的<code>onCreate()</code>中初始化，记得在<code>manifest.xml</code>中注册<code>Application</code>。</p>

<h3>
<a id="一般情况下只需要这样初始化" class="anchor" href="#%E4%B8%80%E8%88%AC%E6%83%85%E5%86%B5%E4%B8%8B%E5%8F%AA%E9%9C%80%E8%A6%81%E8%BF%99%E6%A0%B7%E5%88%9D%E5%A7%8B%E5%8C%96" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>一般情况下只需要这样初始化</h3>

<p>直接初始化后，一切采用默认设置。</p>

<div class="highlight highlight-source-java"><pre><span class="pl-smi">NoHttp</span><span class="pl-k">.</span>initialize(<span class="pl-v">this</span>);</pre></div>

<h3>
<a id="如果需要自定义配置更多信息" class="anchor" href="#%E5%A6%82%E6%9E%9C%E9%9C%80%E8%A6%81%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE%E6%9B%B4%E5%A4%9A%E4%BF%A1%E6%81%AF" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>如果需要自定义配置更多信息</h3>

<ul>
<li>超时配置，默认10s</li>
</ul>

<div class="highlight highlight-source-java"><pre><span class="pl-smi">NoHttp</span><span class="pl-k">.</span>initialize(<span class="pl-v">this</span>, <span class="pl-k">new</span> <span class="pl-smi">NoHttp</span>.<span class="pl-smi">Config</span>()
    <span class="pl-c">// 设置全局连接超时时间，单位毫秒</span>
    .setConnectTimeout(<span class="pl-c1">30</span> <span class="pl-k">*</span> <span class="pl-c1">1000</span>)
    <span class="pl-c">// 设置全局服务器响应超时时间，单位毫秒</span>
    .setReadTimeout(<span class="pl-c1">30</span> <span class="pl-k">*</span> <span class="pl-c1">1000</span>)
);</pre></div>

<ul>
<li>配置缓存，默认保存在数据库</li>
</ul>

<div class="highlight highlight-source-java"><pre><span class="pl-smi">NoHttp</span><span class="pl-k">.</span>initialize(<span class="pl-v">this</span>, <span class="pl-k">new</span> <span class="pl-smi">NoHttp</span>.<span class="pl-smi">Config</span>()
    <span class="pl-c1">...</span>
    <span class="pl-c">// 保存到数据库</span>
    .setCacheStore(
        <span class="pl-k">new</span> <span class="pl-smi">DBCacheStore</span>(<span class="pl-v">this</span>)<span class="pl-k">.</span>setEnable(<span class="pl-c1">true</span>) <span class="pl-c">// 如果不使用缓存，设置false禁用。</span>
    )
    <span class="pl-c">// 或者保存到SD卡</span>
    .setCacheStore(
        <span class="pl-k">new</span> <span class="pl-smi">DiskCacheStore</span>(<span class="pl-v">this</span>)
    )
);</pre></div>

<ul>
<li>配置Cookie保存的位置，默认保存在数据库</li>
</ul>

<div class="highlight highlight-source-java"><pre><span class="pl-smi">NoHttp</span><span class="pl-k">.</span>initialize(<span class="pl-v">this</span>, <span class="pl-k">new</span> <span class="pl-smi">NoHttp</span>.<span class="pl-smi">Config</span>()
    <span class="pl-c1">...</span>
    <span class="pl-c">// 默认保存数据库DBCookieStore，开发者可以自己实现。</span>
    .setCookieStore(
        <span class="pl-k">new</span> <span class="pl-smi">DBCookieStore</span>(<span class="pl-v">this</span>)<span class="pl-k">.</span>setEnable(<span class="pl-c1">false</span>) <span class="pl-c">// 如果不维护cookie，设置false禁用。</span>
    )
);</pre></div>

<ul>
<li>配置网络层</li>
</ul>

<div class="highlight highlight-source-java"><pre><span class="pl-smi">NoHttp</span><span class="pl-k">.</span>initialize(<span class="pl-v">this</span>, <span class="pl-k">new</span> <span class="pl-smi">NoHttp</span>.<span class="pl-smi">Config</span>()
    <span class="pl-c1">...</span>
    <span class="pl-c">// 使用HttpURLConnection</span>
    .setNetworkExecutor(<span class="pl-k">new</span> <span class="pl-smi">URLConnectionNetworkExecutor</span>())
    <span class="pl-c">// 使用OkHttp</span>
    .setNetworkExecutor(<span class="pl-k">new</span> <span class="pl-smi">OkHttpNetworkExecutor</span>())
);</pre></div>

<h2>
<a id="权限" class="anchor" href="#%E6%9D%83%E9%99%90" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>权限</h2>

<div class="highlight highlight-text-xml"><pre>&lt;<span class="pl-ent">uses-permission</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.permission.READ_EXTERNAL_STORAGE<span class="pl-pds">"</span></span> /&gt;
&lt;<span class="pl-ent">uses-permission</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.permission.WRITE_EXTERNAL_STORAGE<span class="pl-pds">"</span></span> /&gt;
&lt;<span class="pl-ent">uses-permission</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.permission.INTERNET<span class="pl-pds">"</span></span> /&gt;
&lt;<span class="pl-ent">uses-permission</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.permission.ACCESS_NETWORK_STATE<span class="pl-pds">"</span></span> /&gt;
&lt;<span class="pl-ent">uses-permission</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.permission.ACCESS_WIFI_STATE<span class="pl-pds">"</span></span> /&gt;</pre></div>

<h2>
<a id="友好的调试模式" class="anchor" href="#%E5%8F%8B%E5%A5%BD%E7%9A%84%E8%B0%83%E8%AF%95%E6%A8%A1%E5%BC%8F" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>友好的调试模式</h2>

<div class="highlight highlight-source-java"><pre><span class="pl-smi">Logger</span><span class="pl-k">.</span>setDebug(<span class="pl-c1">true</span>);<span class="pl-c">// 开启NoHttp的调试模式, 配置后可看到请求过程、日志和错误信息。</span>
<span class="pl-smi">Logger</span><span class="pl-k">.</span>setTag(<span class="pl-s"><span class="pl-pds">"</span>NoHttpSample<span class="pl-pds">"</span></span>);<span class="pl-c">// 设置NoHttp打印Log的tag。</span></pre></div>

<p>开启NoHttp的调试模式后可看到请求过程、日志和错误信息，基本不用抓包。可以看到请求头、请求数据、响应头、Cookie等，而且打印出的Log非常整齐。</p>

<p>所以说，如果你使用过程中遇到什么问题了，开启调试模式，一切妖魔鬼怪都会现形的。</p>

<h2>
<a id="第三方异步框架" class="anchor" href="#%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BC%82%E6%AD%A5%E6%A1%86%E6%9E%B6" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>第三方异步框架</h2>

<p>可以与RxJava、RxAndroid、RxBus、EventBus等第三方异步任务框架完美结合使用，这里在demo中给出了和RxJava一起使用的代码。</p>

<h3>
<a id="rxjava" class="anchor" href="#rxjava" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>RxJava</h3>

<p>NoHttp可以和RxJava完美结合，这里列出如何使用，具体的封装请参考Demo的RxNoHttp。</p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">Request&lt;<span class="pl-smi">UserInfo</span>&gt;</span> request <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-k">JavaBeanRequest&lt;&gt;</span>(url, <span class="pl-smi">UserInfo</span><span class="pl-k">.</span>class);
<span class="pl-smi">RxNoHttp</span><span class="pl-k">.</span>request(<span class="pl-v">this</span>, request, <span class="pl-k">new</span> <span class="pl-k">SimpleSubscriber&lt;<span class="pl-k">Response&lt;<span class="pl-smi">UserInfo</span>&gt;</span>&gt;</span>() {
    <span class="pl-k">@Override</span>
    <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">onNext</span>(<span class="pl-k">Response&lt;<span class="pl-smi">YanZhenjie</span>&gt;</span> <span class="pl-v">entityResponse</span>) {
        <span class="pl-c">// 直接拿到实体对象</span>
        <span class="pl-smi">UserInfo</span> userInfo <span class="pl-k">=</span> entiryResponse<span class="pl-k">.</span>get();
    }
});</pre></div>

<h2>
<a id="请求队列" class="anchor" href="#%E8%AF%B7%E6%B1%82%E9%98%9F%E5%88%97" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>请求队列</h2>

<div class="highlight highlight-source-java"><pre><span class="pl-smi">RequestQueue</span> requestQueue <span class="pl-k">=</span> <span class="pl-smi">NoHttp</span><span class="pl-k">.</span>newRequestQueue();
<span class="pl-c">// 如果要指定并发值，传入数字即可：NoHttp.newRequestQueue(3);</span>

<span class="pl-c">// 发起请求</span>
requestQueue<span class="pl-k">.</span>add(what, request, responseListener);</pre></div>

<ul>
<li>添加请求到队列时有一个what，这个what会在<code>responseLisetener</code>响应时回调给开发者，所以开发者可以用一个<code>responseLisetener</code>接受多个请求的响应，用what来区分结果。而不用像有的框架一样，每一个请求都要new一个callback。<br>
</li>
<li>
<strong>强烈建议</strong>把生成队列写成懒汉单例模式，因为每新建队列就会new出相应个数的线程来，同时只有线程数固定了，队列的作用才会发挥到最大。</li>
</ul>

<h2>
<a id="几种数据类型请求" class="anchor" href="#%E5%87%A0%E7%A7%8D%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E8%AF%B7%E6%B1%82" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>几种数据类型请求</h2>

<h3>
<a id="string请求" class="anchor" href="#string%E8%AF%B7%E6%B1%82" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>String请求</h3>

<div class="highlight highlight-source-java"><pre><span class="pl-k">Request&lt;<span class="pl-smi">String</span>&gt;</span> request <span class="pl-k">=</span> <span class="pl-smi">NoHttp</span><span class="pl-k">.</span>createStringRequest(url, <span class="pl-smi">RequestMethod</span><span class="pl-c1"><span class="pl-k">.</span>GET</span>);
requestQueue<span class="pl-k">.</span>add(<span class="pl-c1">0</span>, request, listener);</pre></div>

<h3>
<a id="json请求" class="anchor" href="#json%E8%AF%B7%E6%B1%82" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Json请求</h3>

<div class="highlight highlight-source-java"><pre><span class="pl-c">// JsonObject</span>
<span class="pl-k">Request&lt;<span class="pl-smi">JSONObject</span>&gt;</span> objRequest <span class="pl-k">=</span> <span class="pl-smi">NoHttp</span><span class="pl-k">.</span>createJsonObjectRequest(url, <span class="pl-smi">RequestMethod</span><span class="pl-c1"><span class="pl-k">.</span>POST</span>);
requestQueue<span class="pl-k">.</span>add(<span class="pl-c1">0</span>, objRequest, listener);

<span class="pl-c">// JsonArray</span>
<span class="pl-k">Request&lt;<span class="pl-smi">JSONArray</span>&gt;</span> arrayRequest <span class="pl-k">=</span> <span class="pl-smi">NoHttp</span><span class="pl-k">.</span>createJsonArrayRequest(url, <span class="pl-smi">RequestMethod</span><span class="pl-c1"><span class="pl-k">.</span>PUT</span>);
requestQueue<span class="pl-k">.</span>add(<span class="pl-c1">0</span>, arrayRequest, listener);</pre></div>

<h3>
<a id="bitmap请求" class="anchor" href="#bitmap%E8%AF%B7%E6%B1%82" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Bitmap请求</h3>

<div class="highlight highlight-source-java"><pre><span class="pl-k">Request&lt;<span class="pl-smi">Bitmap</span>&gt;</span> request <span class="pl-k">=</span> <span class="pl-smi">NoHttp</span><span class="pl-k">.</span>createImageRequest(url, <span class="pl-smi">RequestMethod</span><span class="pl-c1"><span class="pl-k">.</span>DELETE</span>);
requestQueue<span class="pl-k">.</span>add(<span class="pl-c1">0</span>, request, listener);</pre></div>

<h3>
<a id="请求fastjson与gson" class="anchor" href="#%E8%AF%B7%E6%B1%82fastjson%E4%B8%8Egson" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>请求FastJson与Gson</h3>

<div class="highlight highlight-source-java"><pre><span class="pl-c">// FastJson</span>
<span class="pl-k">Request&lt;<span class="pl-smi">JSONObject</span>&gt;</span> request <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">FastJsonRequest</span>(url, <span class="pl-smi">RequestMethod</span><span class="pl-c1"><span class="pl-k">.</span>POST</span>);
requestQueue<span class="pl-k">.</span>add(<span class="pl-c1">0</span>, request, listener);</pre></div>

<h3>
<a id="直接请求javabean" class="anchor" href="#%E7%9B%B4%E6%8E%A5%E8%AF%B7%E6%B1%82javabean" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>直接请求JavaBean</h3>

<div class="highlight highlight-source-java"><pre><span class="pl-c">// 内部使用Gson、FastJson解析成JavaBean</span>
<span class="pl-k">Request&lt;<span class="pl-smi">UserInfo</span>&gt;</span> request <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">JavaBeanRequest</span>(url, <span class="pl-smi">RequestMethod</span><span class="pl-c1"><span class="pl-k">.</span>GET</span>);
requestQueue<span class="pl-k">.</span>add(<span class="pl-c1">0</span>, request, listener);</pre></div>

<h2>
<a id="添加参数" class="anchor" href="#%E6%B7%BB%E5%8A%A0%E5%8F%82%E6%95%B0" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>添加参数</h2>

<div class="highlight highlight-source-java"><pre><span class="pl-k">Request&lt;<span class="pl-smi">JSONObject</span>&gt;</span> request <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">JavaBeanRequest</span>(url, <span class="pl-smi">RequestMethod</span><span class="pl-c1"><span class="pl-k">.</span>POST</span>);
   .add(<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>yoldada<span class="pl-pds">"</span></span>) <span class="pl-c">// String类型</span>
   .add(<span class="pl-s"><span class="pl-pds">"</span>age<span class="pl-pds">"</span></span>, <span class="pl-c1">18</span>) <span class="pl-c">// int类型</span>
   .add(<span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">'</span>0<span class="pl-pds">'</span></span>) <span class="pl-c">// char类型</span>
   .add(<span class="pl-s"><span class="pl-pds">"</span>time<span class="pl-pds">"</span></span>, <span class="pl-c1">16346468473154</span>) <span class="pl-c">// long类型</span>

   <span class="pl-c">// 添加Bitmap</span>
   .add(<span class="pl-s"><span class="pl-pds">"</span>head<span class="pl-pds">"</span></span>, <span class="pl-k">new</span> <span class="pl-smi">BitmapBinary</span>(bitmap))
   <span class="pl-c">// 添加File</span>
   .add(<span class="pl-s"><span class="pl-pds">"</span>head<span class="pl-pds">"</span></span>, <span class="pl-k">new</span> <span class="pl-smi">FileBinary</span>(file))
   <span class="pl-c">// 添加ByteArray</span>
   .add(<span class="pl-s"><span class="pl-pds">"</span>head<span class="pl-pds">"</span></span>, <span class="pl-k">new</span> <span class="pl-smi">ByteArrayBinary</span>(<span class="pl-k">byte</span>[]))
   <span class="pl-c">// 添加InputStream</span>
   .add(<span class="pl-s"><span class="pl-pds">"</span>head<span class="pl-pds">"</span></span>, <span class="pl-k">new</span> <span class="pl-smi">InputStreamBinary</span>(inputStream));</pre></div>

<p>文件上传实现了http表单的标准协议，满足了广大开发者的需求，有以下几种形式：</p>

<ul>
<li>单个文件</li>
</ul>

<div class="highlight highlight-source-java"><pre><span class="pl-k">Request&lt;<span class="pl-smi">String</span>&gt;</span> request <span class="pl-k">=</span> <span class="pl-c1">...</span>
request<span class="pl-k">.</span>add(<span class="pl-s"><span class="pl-pds">"</span>file<span class="pl-pds">"</span></span>, <span class="pl-k">new</span> <span class="pl-smi">FileBinary</span>(file));</pre></div>

<ul>
<li>上传多个文件、多个Key多个文件形式<br>
这里可以添加各种形式的文件，File、Bitmap、InputStream、ByteArray。</li>
</ul>

<div class="highlight highlight-source-java"><pre><span class="pl-k">Request&lt;<span class="pl-smi">String</span>&gt;</span> request <span class="pl-k">=</span> <span class="pl-c1">...</span>
request<span class="pl-k">.</span>add(<span class="pl-s"><span class="pl-pds">"</span>file1<span class="pl-pds">"</span></span>, <span class="pl-k">new</span> <span class="pl-smi">FileBinary</span>(<span class="pl-smi">File</span>));
request<span class="pl-k">.</span>add(<span class="pl-s"><span class="pl-pds">"</span>file2<span class="pl-pds">"</span></span>, <span class="pl-k">new</span> <span class="pl-smi">FileBinary</span>(<span class="pl-smi">File</span>));
request<span class="pl-k">.</span>add(<span class="pl-s"><span class="pl-pds">"</span>file3<span class="pl-pds">"</span></span>, <span class="pl-k">new</span> <span class="pl-smi">InputStreamBinary</span>(<span class="pl-smi">InputStream</span>));
request<span class="pl-k">.</span>add(<span class="pl-s"><span class="pl-pds">"</span>file4<span class="pl-pds">"</span></span>, <span class="pl-k">new</span> <span class="pl-smi">ByteArrayBinary</span>(<span class="pl-k">byte</span>[]));
request<span class="pl-k">.</span>add(<span class="pl-s"><span class="pl-pds">"</span>file5<span class="pl-pds">"</span></span>, <span class="pl-k">new</span> <span class="pl-smi">BitmapBinary</span>(<span class="pl-smi">Bitmap</span>));</pre></div>

<ul>
<li>上传多个文件、一个Key多个文件形式</li>
</ul>

<div class="highlight highlight-source-java"><pre><span class="pl-k">Request&lt;<span class="pl-smi">String</span>&gt;</span> request <span class="pl-k">=</span> <span class="pl-c1">...</span>
fileList<span class="pl-k">.</span>add(<span class="pl-s"><span class="pl-pds">"</span>image<span class="pl-pds">"</span></span>, <span class="pl-k">new</span> <span class="pl-smi">FileBinary</span>(<span class="pl-smi">File</span>));
fileList<span class="pl-k">.</span>add(<span class="pl-s"><span class="pl-pds">"</span>image<span class="pl-pds">"</span></span>, <span class="pl-k">new</span> <span class="pl-smi">InputStreamBinary</span>(<span class="pl-smi">InputStream</span>));
fileList<span class="pl-k">.</span>add(<span class="pl-s"><span class="pl-pds">"</span>image<span class="pl-pds">"</span></span>, <span class="pl-k">new</span> <span class="pl-smi">ByteArrayBinary</span>(<span class="pl-k">byte</span>[]));
fileList<span class="pl-k">.</span>add(<span class="pl-s"><span class="pl-pds">"</span>image<span class="pl-pds">"</span></span>, <span class="pl-k">new</span> <span class="pl-smi">BitmapBinary</span>(<span class="pl-smi">Bitmap</span>));</pre></div>

<p>或者：  </p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">Request&lt;<span class="pl-smi">String</span>&gt;</span> request <span class="pl-k">=</span> <span class="pl-c1">...</span>

<span class="pl-k">List&lt;<span class="pl-smi">Binary</span>&gt;</span> fileList <span class="pl-k">=</span> <span class="pl-c1">...</span>
fileList<span class="pl-k">.</span>add(<span class="pl-k">new</span> <span class="pl-smi">FileBinary</span>(<span class="pl-smi">File</span>));
fileList<span class="pl-k">.</span>add(<span class="pl-k">new</span> <span class="pl-smi">InputStreamBinary</span>(<span class="pl-smi">InputStream</span>));
fileList<span class="pl-k">.</span>add(<span class="pl-k">new</span> <span class="pl-smi">ByteArrayBinary</span>(<span class="pl-k">byte</span>[]));
fileList<span class="pl-k">.</span>add(<span class="pl-k">new</span> <span class="pl-smi">BitmapStreamBinary</span>(<span class="pl-smi">Bitmap</span>));
request<span class="pl-k">.</span>add(<span class="pl-s"><span class="pl-pds">"</span>file_list<span class="pl-pds">"</span></span>, fileList);</pre></div>

<h2>
<a id="提交请求包体" class="anchor" href="#%E6%8F%90%E4%BA%A4%E8%AF%B7%E6%B1%82%E5%8C%85%E4%BD%93" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>提交请求包体</h2>

<p>提交Body分为提交Json、提交String、提交Xml、提交流等，具体用法如下：</p>

<div class="highlight highlight-source-java"><pre><span class="pl-c">// 提交普通String</span>
request<span class="pl-k">.</span>setDefineRequestBody(<span class="pl-smi">String</span>, <span class="pl-smi">ContentType</span>);

<span class="pl-c">// 提交json字符串</span>
request<span class="pl-k">.</span>setDefineRequestBodyForJson(<span class="pl-smi">JsonString</span>)

<span class="pl-c">// 提交jsonObject对象，其实还是json字符串</span>
request<span class="pl-k">.</span>setDefineRequestBodyForJson(<span class="pl-smi">JSONObject</span>)

<span class="pl-c">// 提交xml字符串</span>
request<span class="pl-k">.</span>setDefineRequestBodyForXML(<span class="pl-smi">XmlString</span>)

<span class="pl-c">// 提交字体Body，比如File（这跟表单上传不一样的），可以转为InputStream来提交</span>
request<span class="pl-k">.</span>setDefineRequestBody(<span class="pl-smi">InputStream</span>, <span class="pl-smi">ContentType</span>)</pre></div>

<h2>
<a id="同步请求" class="anchor" href="#%E5%90%8C%E6%AD%A5%E8%AF%B7%E6%B1%82" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>同步请求</h2>

<p>在当前线程发起请求，在线程这么使用。</p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">Request&lt;<span class="pl-smi">String</span>&gt;</span> request <span class="pl-k">=</span> <span class="pl-smi">NoHttp</span><span class="pl-k">.</span>createStringRequest(url, <span class="pl-smi">RequestMethod</span><span class="pl-c1"><span class="pl-k">.</span>DELETE</span>);
<span class="pl-k">Response&lt;<span class="pl-smi">String</span>&gt;</span> response <span class="pl-k">=</span> <span class="pl-smi">NoHttp</span><span class="pl-k">.</span>startRequestSync(request);
<span class="pl-k">if</span> (response<span class="pl-k">.</span>isSucceed()) {
    <span class="pl-c">// 请求成功</span>
} <span class="pl-k">else</span> {
    <span class="pl-c">// 请求失败</span>
}</pre></div>

<h2>
<a id="五大缓存模式" class="anchor" href="#%E4%BA%94%E5%A4%A7%E7%BC%93%E5%AD%98%E6%A8%A1%E5%BC%8F" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>五大缓存模式</h2>

<p>NoHttp的缓存非常强大，支持缓存到数据库、换到SD卡等，并且不论缓存在数据库或者SD，NoHttp都把数据进行了加密，需要在初始化的时候配置缓存的位置。</p>

<p>需要注意的是，在6.0以上的手机中如果要缓存在SD卡，需要在请求之前，需要请求运行时权限，如果你不懂运行时权限，可以看这个项目：<a href="https://github.com/yanzhenjie/AndPermission">AndPermission</a>。</p>

<div class="highlight highlight-source-java"><pre><span class="pl-smi">NoHttp</span><span class="pl-k">.</span>initialize(<span class="pl-v">this</span>, <span class="pl-k">new</span> <span class="pl-smi">NoHttp</span>.<span class="pl-smi">Config</span>()
    <span class="pl-c1">...</span>
    <span class="pl-c">// 保存到数据库</span>
    .setCacheStore(
        <span class="pl-k">new</span> <span class="pl-smi">DBCacheStore</span>(<span class="pl-v">this</span>)<span class="pl-k">.</span>setEnable(<span class="pl-c1">true</span>) <span class="pl-c">// 如果不使用缓存，设置false禁用。</span>
    )
    <span class="pl-c">// 或者保存到SD卡</span>
    .setCacheStore(
        <span class="pl-k">new</span> <span class="pl-smi">DiskCacheStore</span>(<span class="pl-v">this</span>)
    )
);</pre></div>

<ul>
<li>1、Default模式，实现http 304重定向缓存
NoHttp本身是实现了RFC2616，所以这里不用设置或者设置为DEFAULT。</li>
</ul>

<div class="highlight highlight-source-java"><pre><span class="pl-k">Request&lt;<span class="pl-smi">JSONObject</span>&gt;</span> request <span class="pl-k">=</span> <span class="pl-smi">NoHttp</span><span class="pl-k">.</span>createJsonObjectRequest(url);
request<span class="pl-k">.</span>setCacheMode(<span class="pl-smi">CacheMode</span><span class="pl-c1"><span class="pl-k">.</span>DEFAULT</span>);</pre></div>

<ul>
<li>2、 当请求服务器失败的时候，读取缓存
请求服务器成功则返回服务器数据，如果请求服务器失败，读取缓存数据返回。</li>
</ul>

<div class="highlight highlight-source-java"><pre><span class="pl-k">Request&lt;<span class="pl-smi">JSONObject</span>&gt;</span> request <span class="pl-k">=</span> <span class="pl-smi">NoHttp</span><span class="pl-k">.</span>createJsonObjectRequest(url);
request<span class="pl-k">.</span>setCacheMode(<span class="pl-smi">CacheMode</span><span class="pl-c1"><span class="pl-k">.</span>REQUEST_NETWORK_FAILED_READ_CACHE</span>);</pre></div>

<ul>
<li>3、如果发现有缓存直接成功，没有缓存才请求服务器
我们知道ImageLoader的核心除了内存优化外，剩下一个就是发现把内地有图片则直接使用，没有则请求服务器，所以NoHttp这一点非常使用做一个ImageLoader。<br>
</li>
</ul>

<p>请求String，缓存String：</p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">Request&lt;<span class="pl-smi">JSONObject</span>&gt;</span> request <span class="pl-k">=</span> <span class="pl-smi">NoHttp</span><span class="pl-k">.</span>createJsonObjectRequest(url);
<span class="pl-c">// 非标准Http协议，改变缓存模式为IF_NONE_CACHE_REQUEST_NETWORK</span>
request<span class="pl-k">.</span>setCacheMode(<span class="pl-smi">CacheMode</span><span class="pl-c1"><span class="pl-k">.</span>IF_NONE_CACHE_REQUEST_NETWORK</span>);</pre></div>

<p>请求图片，缓存图片：</p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">Request&lt;<span class="pl-smi">Bitmap</span>&gt;</span> request <span class="pl-k">=</span> <span class="pl-smi">NoHttp</span><span class="pl-k">.</span>createImageRequest(imageUrl);
request<span class="pl-k">.</span>setCacheMode(<span class="pl-smi">CacheMode</span><span class="pl-c1"><span class="pl-k">.</span>IF_NONE_CACHE_REQUEST_NETWORK</span>);</pre></div>

<ul>
<li>4、仅仅请求网络
这里不会读取缓存，也不支持Http304。</li>
</ul>

<div class="highlight highlight-source-java"><pre><span class="pl-k">Request&lt;<span class="pl-smi">Bitmap</span>&gt;</span> request <span class="pl-k">=</span> <span class="pl-smi">NoHttp</span><span class="pl-k">.</span>createImageRequest(imageUrl);
request<span class="pl-k">.</span>setCacheMode(<span class="pl-smi">CacheMode</span><span class="pl-c1"><span class="pl-k">.</span>ONLY_REQUEST_NETWORK</span>);
<span class="pl-c1">...</span></pre></div>

<ul>
<li>5、仅仅读取缓存
仅仅读取缓存，不会请求网络和其它操作。</li>
</ul>

<div class="highlight highlight-source-java"><pre><span class="pl-k">Request&lt;<span class="pl-smi">Bitmap</span>&gt;</span> request <span class="pl-k">=</span> <span class="pl-smi">NoHttp</span><span class="pl-k">.</span>createImageRequest(imageUrl);
request<span class="pl-k">.</span>setCacheMode(<span class="pl-smi">CacheMode</span><span class="pl-c1"><span class="pl-k">.</span>ONLY_READ_CACHE</span>);</pre></div>

<h2>
<a id="文件下载" class="anchor" href="#%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>文件下载</h2>

<p>因为下载文件代码比较多，这里贴关键部分，具体的请参考demo。  </p>

<p>文件下载也是队列，队列和开头所说的请求的队列是一样的。</p>

<ul>
<li>发起下载请求</li>
</ul>

<div class="highlight highlight-source-java"><pre><span class="pl-c">//下载文件</span>
downloadRequest <span class="pl-k">=</span> <span class="pl-smi">NoHttp</span><span class="pl-k">.</span>createDownloadRequest<span class="pl-k">.</span><span class="pl-c1">..</span>
<span class="pl-c">// what 区分下载</span>
<span class="pl-c">// downloadRequest 下载请求对象</span>
<span class="pl-c">// downloadListener 下载监听</span>
downloadQueue<span class="pl-k">.</span>add(<span class="pl-c1">0</span>, downloadRequest, downloadListener);</pre></div>

<ul>
<li>暂停或者停止下载</li>
</ul>

<div class="highlight highlight-source-java"><pre>downloadRequest<span class="pl-k">.</span>cancel();</pre></div>

<ul>
<li>监听下载过程</li>
</ul>

<div class="highlight highlight-source-java"><pre><span class="pl-k">private</span> <span class="pl-smi">DownloadListener</span> downloadListener <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DownloadListener</span>() {
    <span class="pl-k">@Override</span>
    <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">onStart</span>(<span class="pl-k">int</span> <span class="pl-v">what</span>, <span class="pl-k">boolean</span> <span class="pl-v">resume</span>, <span class="pl-k">long</span> <span class="pl-v">preLenght</span>, <span class="pl-smi">Headers</span> <span class="pl-v">header</span>, <span class="pl-k">long</span> <span class="pl-v">count</span>) {
        <span class="pl-c">// 下载开始</span>
    }

    <span class="pl-k">@Override</span>
    <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">onProgress</span>(<span class="pl-k">int</span> <span class="pl-v">what</span>, <span class="pl-k">int</span> <span class="pl-v">progress</span>, <span class="pl-k">long</span> <span class="pl-v">downCount</span>) {
        <span class="pl-c">// 更新下载进度</span>
    }

    <span class="pl-k">@Override</span>
    <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">onFinish</span>(<span class="pl-k">int</span> <span class="pl-v">what</span>, <span class="pl-smi">String</span> <span class="pl-v">filePath</span>) {
        <span class="pl-c">// 下载完成</span>
    }

    <span class="pl-k">@Override</span>
    <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">onDownloadError</span>(<span class="pl-k">int</span> <span class="pl-v">what</span>, <span class="pl-smi">StatusCode</span> <span class="pl-v">code</span>, <span class="pl-smi">CharSequence</span> <span class="pl-v">message</span>) {
        <span class="pl-c">// 下载发生错误</span>
    }

    <span class="pl-k">@Override</span>
    <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">onCancel</span>(<span class="pl-k">int</span> <span class="pl-v">what</span>) {
        <span class="pl-c">// 下载被取消或者暂停</span>
    }
};</pre></div>

<h2>
<a id="取消请求" class="anchor" href="#%E5%8F%96%E6%B6%88%E8%AF%B7%E6%B1%82" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>取消请求</h2>

<p>NoHttp支持取消某个请求、取消指定多个请求、取消所有请求。</p>

<ul>
<li>取消单个请求<br>
直接调用请求对象的cancel方法。</li>
</ul>

<div class="highlight highlight-source-java"><pre>request<span class="pl-k">.</span>cancel();</pre></div>

<ul>
<li>从队列中取消指定的请求
在请求之前给请求set一个sign，取消的时候调用队列的cancelBySign就可以取消掉所有指定这个sign的请求。</li>
</ul>

<div class="highlight highlight-source-java"><pre>request1<span class="pl-k">.</span>setCancelSign(sign);
request2<span class="pl-k">.</span>setCancelSign(sign);
<span class="pl-c1">...</span>

<span class="pl-c">// 取消队列中多个用sign标志的请求</span>
queue<span class="pl-k">.</span>cancelBySign(sign);</pre></div>

<ul>
<li>取消队列中所有请求</li>
</ul>

<div class="highlight highlight-source-java"><pre>queue<span class="pl-k">.</span>cancelAll();</pre></div>

<h2>
<a id="停止队列" class="anchor" href="#%E5%81%9C%E6%AD%A2%E9%98%9F%E5%88%97" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>停止队列</h2>

<p>队列停止后再添加请求到队列后，请求不会被执行。</p>

<div class="highlight highlight-source-java"><pre><span class="pl-smi">RequestQueue</span> queue <span class="pl-k">=</span> <span class="pl-smi">NoHttp</span><span class="pl-k">.</span>newRequestQueue();
<span class="pl-c1">...</span>

queue<span class="pl-k">.</span>stop();</pre></div>

<h2>
<a id="自定义请求" class="anchor" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AF%B7%E6%B1%82" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>自定义请求</h2>

<ul>
<li>FastJsonRequest</li>
</ul>

<div class="highlight highlight-source-java"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">FastJsonRequest</span> <span class="pl-k">extends</span> <span class="pl-e">RestRequestor&lt;<span class="pl-smi">JSONObject</span>&gt;</span> {

    <span class="pl-k">public</span> <span class="pl-en">FastJsonRequest</span>(<span class="pl-smi">String</span> <span class="pl-v">url</span>) {
        <span class="pl-v">this</span>(url, <span class="pl-smi">RequestMethod</span><span class="pl-c1"><span class="pl-k">.</span>GET</span>);
    }

    <span class="pl-k">public</span> <span class="pl-en">FastJsonRequest</span>(<span class="pl-smi">String</span> <span class="pl-v">url</span>, <span class="pl-smi">RequestMethod</span> <span class="pl-v">requestMethod</span>) {
        <span class="pl-v">super</span>(url, requestMethod);
    }

    <span class="pl-k">@Override</span>
    <span class="pl-k">public</span> <span class="pl-smi">JSONObject</span> <span class="pl-en">parseResponse</span>(<span class="pl-smi">Headers</span> <span class="pl-v">header</span>, <span class="pl-k">byte</span>[] <span class="pl-v">body</span>) <span class="pl-k">throws</span> <span class="pl-smi">Throwable</span> {
        <span class="pl-smi">String</span> result <span class="pl-k">=</span> <span class="pl-smi">StringRequest</span><span class="pl-k">.</span>parseResponseString(headers, body);
        <span class="pl-k">return</span> <span class="pl-c1">JSON</span><span class="pl-k">.</span>parseObject(result);
    }
}</pre></div>

<ul>
<li>JavaBeanRequest，利用FastJson、Gson等把数据直接转为JavaBean</li>
</ul>

<div class="highlight highlight-source-java"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">JavaBeanRequest</span>&lt;T&gt; <span class="pl-k">extends</span> <span class="pl-e">RestRequest&lt;<span class="pl-smi">T</span>&gt;</span> {
    <span class="pl-k">private</span> <span class="pl-k">Class&lt;<span class="pl-smi">T</span>&gt;</span> clazz;

    <span class="pl-k">public</span> <span class="pl-en">JavaBeanRequest</span>(<span class="pl-smi">String</span> <span class="pl-v">url</span>, <span class="pl-k">Class&lt;<span class="pl-smi">T</span>&gt;</span> <span class="pl-v">clazz</span>) {
        <span class="pl-v">this</span>(url, <span class="pl-smi">RequestMethod</span><span class="pl-c1"><span class="pl-k">.</span>GET</span>, clazz);
    }

    <span class="pl-k">public</span> <span class="pl-en">JavaBeanRequest</span>(<span class="pl-smi">String</span> <span class="pl-v">url</span>, <span class="pl-smi">RequestMethod</span> <span class="pl-v">requestMethod</span>, <span class="pl-k">Class&lt;<span class="pl-smi">T</span>&gt;</span> <span class="pl-v">clazz</span>) {
        <span class="pl-v">super</span>(url, requestMethod);
        <span class="pl-v">this</span><span class="pl-k">.</span>clazz <span class="pl-k">=</span> clazz;
    }

    <span class="pl-k">@Override</span>
    <span class="pl-k">public</span> <span class="pl-smi">T</span> <span class="pl-en">parseResponse</span>(<span class="pl-smi">Headers</span> <span class="pl-v">header</span>, <span class="pl-k">byte</span>[] <span class="pl-v">body</span>) <span class="pl-k">throws</span> <span class="pl-smi">Throwable</span> {
        <span class="pl-smi">String</span> response <span class="pl-k">=</span> <span class="pl-smi">StringRequest</span><span class="pl-k">.</span>parseResponseString(header, body);

        <span class="pl-c">// 这里如果数据格式错误，或者解析失败，会在失败的回调方法中返回 ParseError 异常。</span>
        <span class="pl-k">return</span> <span class="pl-c1">JSON</span><span class="pl-k">.</span>parseObject(response, clazz);
    }
}</pre></div>

<ul>
<li>使用自定义请求</li>
</ul>

<div class="highlight highlight-source-java"><pre><span class="pl-c">// 使用FastJson自定义请求</span>
<span class="pl-k">Request&lt;<span class="pl-smi">JSONObject</span>&gt;</span> request <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">FastJsonRequest</span>(url, requestMethod);
queue<span class="pl-k">.</span>add(what, mRequest, listener);

<span class="pl-c1">...</span>

<span class="pl-c">// 直击请求JavaBean</span>
<span class="pl-k">Request&lt;<span class="pl-smi">UserInfo</span>&gt;</span> request <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">JavaBeanRequest</span>(url, <span class="pl-smi">UserInfo</span><span class="pl-k">.</span>class);
queue<span class="pl-k">.</span>add(what, request, listener);</pre></div>

<h2>
<a id="代码混淆" class="anchor" href="#%E4%BB%A3%E7%A0%81%E6%B7%B7%E6%B7%86" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>代码混淆</h2>

<ol>
<li>NoHttp全部的类都可以混淆。<br>
</li>
<li><p>NoHttp设计到兼容高版本系统的api采用反射调用，所以所有类都可以被混淆  </p></li>
<li><p>如果你非要keep的话，如下配置即可  </p></li>
</ol>

<pre lang="text"><code>-dontwarn com.yolanda.nohttp.**
-keep class com.yolanda.nohttp.**{*;}
</code></pre>

<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>License</h2>

<pre lang="text"><code>Copyright 2016 Yan Zhenjie

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
</code></pre>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/yanzhenjie/NoHttp">Nohttp</a> is maintained by <a href="https://github.com/yanzhenjie">yanzhenjie</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
